<%-- 
  - Author(s):java业务平台代码生成工具
  - Date: ${beanAttribute.createTime?string("yyyy年MM月dd日 HH点mm分ss秒")}
  - Copyright Notice:版权声明 福建讯盟软件有限公司, 版权所有 违者必究
  - @(#)
  - Description:  
  - <功能>${beanAttribute.boDescription}(${beanAttribute.boName})编辑页面
--%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="/common/commons.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>${beanAttribute.boDescription}编辑页面</title>
<style type="text/css">
  .x-grid3-header-offset {width: auto;}
</style>
</head>
<body>
<div id="div_toolbar"></div>
<div id="div_center" class="search"> 
<form id="mainForm" name="mainForm">
<table width="600" border="0" cellpadding="4" cellspacing="1">
<#if bo.formColumnListHeader?exists && (bo.formColumnListHeader?size>0)>
<#list bo.formColumnListHeader?if_exists?sort_by("formRowNo") as column>
<#--(调试用)序号:${column_index};formRowNo:${column.formRowNo} ;rowNo: ${column.rowNo};columnNo: ${column.columnNo};${column.propertyType?if_exists}-->
<#if column.visibility=="X" && column.propertyType !="XX">
<#if column.columnNo=="1">
	<tr>
</#if>
		<td align="right">${column.property.fieldText}：</td>
		<td>
		<#-- UITYPE:${column.uiType} -->
		<#-- 搜索帮助 -->
		<#if column.uiType=="11">
			<div id="div_${column.propertyName}_sh"></div>
			<fisc:searchHelp divId="div_${column.propertyName}_sh" boName="${beanAttribute.boName}" boProperty="${column.propertyName}" searchType="field" hiddenName="${beanAttribute.boName}.${column.propertyName}" valueField="${column.property.shSourceColumn}" displayField="${column.property.shTextColumn}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:searchHelp>
		<#-- 下拉列表(字典表) -->
		<#elseif column.uiType=="06">
			<div id="div_${column.propertyName}_dict"></div>
			<fisc:dictionary sourceName="${beanAttribute.boName}.${column.propertyName}" dictionaryName="${column.property.dicTableName}" divId="div_${column.propertyName}_dict" isNeedAuth="false"  selectedValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:dictionary>
		<#-- 日期 -->
		<#elseif column.uiType=="04" || column.uiType=="05">
			<input type="text" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="">
			<#if column.uiType=="04">
				<fisc:calendar applyTo="${beanAttribute.boName}.${column.propertyName}" format="Ymd" divId="" fieldName="" defaultValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:calendar>
			<#elseif column.uiType=="05">
				<fisc:calendar applyTo="${beanAttribute.boName}.${column.propertyName}" format="Ymd" divId="" fieldName="" showTime="true" defaultValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:calendar>
			</#if>
		<#-- 密码框 -->
		<#elseif column.uiType=="03">
			<input type="password" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}">	
		<#-- 备注框 -->
		<#elseif column.uiType=="12">
			<textarea rows="4" cols="54" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></textarea>
		<#-- 其他UI类别 -->
		<#else>
			<input type="text" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}">
		</#if>
		</td>
<#if column.columnNo =="2">
	</tr>
</#if>
<#elseif column.propertyType=="XX">
<#if column.columnNo =="1">
	<tr>
</#if>
        <td></td>
<#if column.columnNo =="2">
	</tr>
</#if>
</#if>
</#list>
</#if>

<#-- Hidden元素 -->
<#if formColumnList?exists && (formColumnList?size>0)>
<#list formColumnList as columnHidden>
<#if columnHidden.visibility?if_exists !="X">
	<input type="hidden" id="${beanAttribute.boName}.${columnHidden.propertyName}" name="${beanAttribute.boName}.${columnHidden.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${columnHidden.propertyName}${"}"}">
</#if>
</#list>
</#if>
</table>
</form>
</div>

<#-- 生成子对象div -->
<#if subBoList?exists && (subBoList?size>0)>
	<#list subBoList?if_exists as subBo>          <#-- 遍历业务对象下所有子对象 -->
		<#if subBo.boName!="Attachement">   
		   <#list bo.properties as property>
		        <#if property.subBoName==subBo.boName> 
		        	<#if property.subBoRelType=="2" || property.subBoRelType=="3">         <#-- 业务对象子对象关系为 1对多、多对多，标签页中为表 -->
<div id="div_${subBo.beanAttribute.boInstanceName}"></div>
                     <#else>    <#-- 业务对象子对象关系为 1对1关系，标签页中为表单域 -->
							<div id="div_${subBo.beanAttribute.boInstanceName}">
							<form id="${subBo.beanAttribute.boInstanceName}Form" name="${subBo.beanAttribute.boInstanceName}Form">
							<table width="600" border="0" cellpadding="4" cellspacing="1">
							<#if subBo.formColumnList?exists && (subBo.formColumnList?size>0)>
							<#list subBo.formColumnList?sort_by("formRowNo") as column>
							<#--(调试用)序号:${column_index};formRowNo:${column.formRowNo}; rowNo: ${column.rowNo};columnNo: ${column.columnNo};${column.propertyType?if_exists}-->
							<#if column.visibility=="X" && column.propertyType !="XX">
							<#if column.columnNo=="1">
								<tr>
							</#if>
									<#if column.uiType=="12">
									<td align="right"  valign="top">${column.property.fieldText}：</td>
									<#else>
									<td align="right" >${column.property.fieldText}：</td>
									</#if>
									<td>
									<#-- UITYPE:${column.uiType} -->
									<#-- 搜索帮助 -->
									<#if column.uiType=="11">
										<div id="div_${column.propertyName}_sh"></div>
										<fisc:searchHelp divId="div_${column.propertyName}_sh" boName="${beanAttribute.boName}" boProperty="${column.propertyName}" searchType="field" hiddenName="${beanAttribute.boName}.${column.propertyName}" valueField="${column.property.shSourceColumn}" displayField="${column.property.shTextColumn}"  value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:searchHelp>
									<#-- 下拉列表(字典表) -->
									<#elseif column.uiType=="06">
										<div id="div_${column.propertyName}_dict"></div>
										<fisc:dictionary sourceName="${beanAttribute.boName}.${column.propertyName}" dictionaryName="${column.property.dicTableName}" divId="div_${column.propertyName}_dict" isNeedAuth="false" selectedValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:dictionary>
									<#-- 日期 -->
									<#elseif column.uiType=="04" || column.uiType=="05">
										<input type="text" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="">
										<#if column.uiType=="04">
											<fisc:calendar applyTo="${beanAttribute.boName}.${column.propertyName}" format="Ymd" divId="" fieldName="" defaultValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:calendar>
										<#elseif column.uiType=="05">
											<fisc:calendar applyTo="${beanAttribute.boName}.${column.propertyName}" format="Ymd" divId="" fieldName="" showTime="true" defaultValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:calendar>
										</#if>
									<#-- 密码框 -->
									<#elseif column.uiType=="03">
										<input type="password" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}">
									<#-- 备注框 -->
									<#elseif column.uiType=="12">
										<textarea rows="4" cols="54" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" >${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}</textarea>
									<#-- 其他UI类别 -->
									<#else>
										<input type="text" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}">
									</#if>
									</td>
							<#if column.columnNo =="2">
								</tr>
							</#if>
							<#elseif column.propertyType=="XX">
								<#if column.columnNo =="1">
									<tr>
								</#if>
								        <td></td><td></td>
								<#if column.columnNo =="2">
									</tr>
								</#if>
							</#if>
							</#list>
							</#if>
							</table>
							<#-- Hidden元素 -->
							<#list subBo.formColumnList as columnHidden>
								<#if columnHidden.visibility?if_exists !="X" && columnHidden.propertyName!="client">
							<input type="hidden" id="${beanAttribute.boName}.${columnHidden.propertyName}" name="${beanAttribute.boName}.${columnHidden.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${columnHidden.propertyName}${"}"}">
								</#if>
							</#list>
							</form>
							</div>                     
				            </#if>
				            </#if>
					   </#list>
					<#else>
			<div id="div_attachement"></div>
					</#if>
	</#list>
<#else>
<div id="div_south"></div>
</#if>

<#-- 生成业务对象标签页div ，如果formColumn有设置的抬头为false的表单元素 -->
<#if bo.formColumnListTab?exists && (bo.formColumnListTab?size>0)>
<div id="div_${beanAttribute.boInstanceName}" class="search"> 
<form id="${beanAttribute.boInstanceName}Form" name="${beanAttribute.boInstanceName}Form">
<table width="600" border="0" cellpadding="4" cellspacing="1">
<#if bo.formColumnListTab?exists && (bo.formColumnListTab?size>0)>
	<#list bo.formColumnListTab?sort_by("formRowNo") as column>
	 <!--(调试用)序号:${column_index};formRowNo:${column.formRowNo}; rowNo: ${column.rowNo};columnNo: ${column.columnNo};${column.propertyType?if_exists}-->
		<#if column.visibility=="X" && column.propertyType !="XX">
		<#if column.columnNo=="1">
			<tr>
		</#if>
				<#if column.uiType=="12">
				<td align="right"  valign="top">${column.property.fieldText}：</td>
				<#else>
				<td align="right" >${column.property.fieldText}：</td>
				</#if>
				<td>
				<!-- UITYPE:${column.uiType} -->
				<#-- 搜索帮助 -->
				<#if column.uiType=="11">
					<div id="div_${column.propertyName}_sh"></div>
					<fisc:searchHelp divId="div_${column.propertyName}_sh" boName="${beanAttribute.boName}" boProperty="${column.propertyName}" searchType="field" hiddenName="${beanAttribute.boName}.${column.propertyName}" valueField="${column.property.shSourceColumn}" displayField="${column.property.shTextColumn}"></fisc:searchHelp>
				<#-- 下拉列表(字典表) -->
				<#elseif column.uiType=="06">
					<div id="div_${column.propertyName}_dict"></div>
					<fisc:dictionary sourceName="${beanAttribute.boName}.${column.propertyName}" dictionaryName="${column.property.dicTableName}" divId="div_${column.propertyName}_dict" isNeedAuth="false" ></fisc:dictionary>
				<#-- 日期 -->
				<#elseif column.uiType=="04" || column.uiType=="05">
					<input type="text" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="">
					<#if column.uiType=="04">
						<fisc:calendar applyTo="${beanAttribute.boName}.${column.propertyName}" format="Ymd" divId="" fieldName="" defaultValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:calendar>
					<#elseif column.uiType=="05">
						<fisc:calendar applyTo="${beanAttribute.boName}.${column.propertyName}" format="Ymd" divId="" fieldName="" showTime="true" defaultValue="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}"></fisc:calendar>
					</#if>
				<#-- 密码框 -->
				<#elseif column.uiType=="03">
					<input type="password" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}">
				<#-- 备注框 -->
				<#elseif column.uiType=="12">
					<textarea rows="4" cols="54" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" >${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}</textarea>	
				<#-- 其他UI类别 -->
				<#else>
					<input type="text" id="${beanAttribute.boName}.${column.propertyName}" name="${beanAttribute.boName}.${column.propertyName}" value="${"$"}${"{"}${beanAttribute.boInstanceName}.${column.propertyName}${"}"}">
				</#if>
				</td>
			<#if column.columnNo =="2">
				</tr>
			</#if>
		<#elseif column.propertyType=="XX">
			<#if column.columnNo =="1">
				<tr>
			</#if>
			      <td></td><td></td>
			<#if column.columnNo =="2">
				</tr>
			</#if>
		</#if>
	</#list>
</#if>
	</table>
	</form>
	</div> 
</#if>

<div id="div_top_north" class="search">
<fisc:workflow-operationBar taskInstanceId="${"$"}${"{"}workflowTaskId${"}"}"></fisc:workflow-operationBar>
</div>
<div id="div_top_south"></div>
<div id="div_east"></div>
<div id="div_west"></div>
</body>
</html>
<script type="text/javascript">
//应用的上下文路径，作为全局变量供js使用
var contextPath = '<%= request.getContextPath() %>';
<#if subBoList?exists && (subBoList?size>0)> 
<#-- 开始生成gridToolbars上所用到的方法 boName  boInstanceName-->
<#list subBoList as subBo>          <#-- 遍历业务对象下所有子对象 -->
<#if subBo.boName!="Attachement">   <#-- 业务对象名字判断，业务附件Attachement不处理 -->
<#if (subBo.gridToolbars?exists) && (subBo.gridToolbars?size>0)>
<#list subBo.gridToolbars as toolbar>
<#if subBo.subBoAttribute.subBoRelType=="2">
<#if toolbar.method.methodName=="_create">
  <#-- 方法 为1：打开到页签-->
  <#if toolbar.method.methodType=="1">
/**
 * grid 上的 创建按钮调用方法 
 * 新增${beanAttribute.boDescription},${subBo.description}
 */
function _create${subBo.boName}()
{
	top.ExtModalWindowUtil.show('${beanAttribute.boDescription}行项目新增',
			contextPath + '/${subBo.beanAttribute.webPath}/${subBo.beanAttribute.boInstanceName}Controller.spr?action=_create','',_insert${subBo.boName}Row,{width:600,height:300});
}

function _insert${subBo.boName}Row()
{
	var json = top.ExtModalWindowUtil.getReturnValue();
	if(json){
	var ${subBo.boName?uncap_first}Fields = new ${subBo.boName}_fields({
	<#if subBo.gridColumns?exists && (subBo.gridColumns?size>0)>
	<#list subBo.gridColumns?if_exists as column>  
		<#if column.property.keyFlag=="X" && column.propertyName!="client"><#-- ${subBo.boName} -->
		${column.propertyName}:''
		</#if>
	</#list>
	<#list subBo.gridColumns?if_exists as column>
		<#if column.uiType!="10" && column.propertyName!="client" && column.property.keyFlag!="X" >
		,${column.propertyName}:''
		</#if>
	</#list>
	</#if>
	});		
	
		${subBo.boName}_grid.stopEditing();
		${subBo.boName}_grid.getStore().insert(0, ${subBo.boName?uncap_first}Fields);
		${subBo.boName}_grid.startEditing(0, 0);
		var record = ${subBo.boName}_grid.getStore().getAt(0);
		<#if subBo.gridColumns?exists && (subBo.gridColumns?size>0)>
		<#list subBo.gridColumns as column>
		<#if (column.uiType!="10" || column.property.keyFlag=="X") && column.propertyName!="client">
		record.set('${column.propertyName}',json["${subBo.boName}.${column.propertyName}"]);
		</#if>
		</#list>
		</#if>
	}
}
	</#if> <#-- End <#if toolbar.method.methodType=="1"> -->
<#elseif toolbar.method.methodName=="_deletes">
<#elseif toolbar.method.methodName=="_copyCreate">
/**
*${beanAttribute.boDescription}行项目
*复制创建
*/
function _copyCreate${subBo.boName}()
{
	if (${subBo.boName}_grid.selModel.hasSelection() > 0){
		var records = ${subBo.boName}_grid.selModel.getSelections();
		if(records.length>1){
			top.Ext.MessageBox.alert('提示', '进行【${beanAttribute.boDescription}行项目复制创建】操作时，只允许选择一条记录！');
			return;
		}   
		var recordData = Ext.util.JSON.encode(records[0].data);
		var pars ="&${subBo.beanAttribute.boInstanceName}="+ recordData;
		_commonMethodOperation('2','复制创建${beanAttribute.boDescription}行项目',${subBo.boName}_grid,'/${subBo.beanAttribute.webPath}/${subBo.beanAttribute.boInstanceName}Controller.spr?action=_copyCreate'+pars);
	}else{
		top.Ext.MessageBox.alert('提示', '请选择需要进行【${beanAttribute.boDescription}行项目复制创建】操作的记录！');
	}	
}
</#if>    <#-- End <#if toolbar.method.methodName=="_create">  -->

<#elseif subBo.subBoAttribute.subBoRelType=="3">
<#list bo.properties?if_exists as boProperty>
<#if boProperty.subBoRelType=="3" && boProperty.propertyName?cap_first==subBo.boName && boProperty.searchHelp!="" && boProperty.searchHelp!=" ">  <#--    CC -->
<#if toolbar.method.methodName=="_create">  <#--    AA -->
/**
*  
*${subBo.description},grid上的增加和删除操作(搜索帮助)回调函数
*/  
function win${subBo.boName}CallBack(jsonArrayData)
{
 	for(var i=0;i<jsonArrayData.length;i++){
 		var isExists = false;
 		for (var j = 0;j<${subBo.boName}_store.getTotalCount();j++){
 			if (${subBo.boName}_store.getAt(j).get('${subBo.primaryKeyProperty.columnName}') == jsonArrayData[i].${subBo.primaryKeyProperty.columnName})
 				isExists = true;
 		}

   if (isExists == false){
 	    var ${subBo.boName?cap_first}Fields = new ${subBo.boName}_fields({
<#if subBo.gridColumns?exists && (subBo.gridColumns?size>0)>
<#list subBo.gridColumns?if_exists as column>  
	<#if column.property.keyFlag=="X" && column.propertyName!="client"><#-- ${subBo.boName} -->
	        ${column.property.propertyName}:''
	</#if>
</#list>
<#list subBo.gridColumns?if_exists as column>
	<#if column.uiType!="10" && column.propertyName!="client" && column.property.keyFlag!="X">
	    <#if column.property.searchHelp=="" || column.property.searchHelp==" ">
	       ,${column.property.propertyName}:''
		<#else>
		   ,${column.property.propertyName}:''
		   ,${column.property.propertyName}_text:''
		</#if>
	</#if>
</#list>
</#if>
	   });		
	   
	   	${subBo.boName}_grid.stopEditing();
		${subBo.boName}_grid.getStore().insert(0, ${subBo.boName?cap_first}Fields);
		${subBo.boName}_grid.startEditing(0, 0);
		var record = ${subBo.boName}_grid.getStore().getAt(0);
		<#if subBo.gridColumns?exists && (subBo.gridColumns?size>0)>
		<#list subBo.gridColumns as column>
		<#if column.property.searchHelp=="" || column.property.searchHelp==" ">
		record.set('${column.property.propertyName}',jsonArrayData[i].${column.property.columnName});
		<#else>
		record.set('${column.property.propertyName}',jsonArrayData[i].${column.property.columnName});
		record.set('${column.property.propertyName}_text',jsonArrayData[i].${column.property.shTextColumn});
		</#if>
		</#list>
		</#if>
 		}
 	}
}

/**
*  
*${subBo.description},grid上的增加和删除操作(搜索帮助)
*/  
var search${subBo.boName}HelpWin = new Ext.SearchHelpWindow({
		shlpName : '${boProperty.searchHelp}',
		callBack : win${subBo.boName}CallBack
});

/**
*  
*${subBo.description},grid上的增加和删除操作,弹出搜索帮助
*/  
function _create${subBo.boName}(){
	search${subBo.boName}HelpWin.show();
}
<#elseif toolbar.method.methodName=="_deletes">

/**
*${subBo.description}
* grid上的和删除操作
*/
function _deletes${subBo.boName}(){
	if (${subBo.boName}_grid.selModel.hasSelection() > 0){
		_getMainFrame().Ext.MessageBox.show({
			title:'提示',
			msg: '数据删除后将不可恢复,是否继续执行此操作?',
			buttons: {yes:'确定', no:'取消'},
			icon: Ext.MessageBox.QUESTION,
			fn:deletes${subBo.boName}ShowResult
		});

		function deletes${subBo.boName}ShowResult(buttonid){
			if (buttonid == 'yes'){
				var records = ${subBo.boName}_grid.selModel.getSelections();
				for (var i=0;i<records.length;i++){
					${subBo.boName}_grid.getStore().remove(records[i]);
				}
			}
		}
	}else{
		_getMainFrame().Ext.MessageBox.alert('提示', '请选择要删除的${subBo.description}信息！');
	}
}
</#if>                                     <#-- END AA -->
</#if>                                     <#-- END CC -->
</#list>
</#if>    <#-- End <#if subo.subBoAttribute.subBoRelType=="2">  -->
</#list>  <#-- End <#list subBo.gridToolbars as toolbar>  -->

<#if subBo.gridColumns?exists && (subBo.gridColumns?size>0)>
<#list subBo.gridColumns as gridColumn>
<#if gridColumn.method?exists >
<#if gridColumn.method.methodName=="_edit">
/**
  * ${beanAttribute.boDescription}行项目编辑操作
  */
function _edit${subBo.boName}(id,url)
{
	url = contextPath+"/"+url;
	//如果不存在id，则为之
	if(!id||id==''||id==' '||id=='undefined'){
		var records = ${subBo.boName}_grid.getSelectionModel().getSelections();     
		var recordData = Ext.util.JSON.encode(records[0].data);
		url = url+"${subBo.beanAttribute.boInstanceName}="+ recordData;//'&subObject={"objectName":"OrderItems","operType":"modify","values":[{}';
	}
	else{
		url = url+"${subBo.primaryKeyProperty.propertyName}="+id;
	}
	//alert(url);
	top.ExtModalWindowUtil.show("${beanAttribute.boDescription}行项目编辑",	url,'','',{width:600,height:400});
}
</#if>
</#if>    <#-- End <#if gridColumn.method?exists> -->
</#list>
</#if>
</#if>
</#if>    <#-- End <#if subBo.boName!="Attachement">  -->
</#list>  <#-- End <#list subBoList as subBo> -->
</#if>

<#if formToolbar.method?exists && (formToolbar?size>0)>
<#list bo.formToolbars as formToolbar>          <#-- 遍历业务对象下所有方法 -->
<#if formToolbar.method.methodName=="_saveOrUpdate"> 					 
/**
 * 保存 
 */
function _saveOrUpdate${beanAttribute.boName}()
{
	var param = Form.serialize('mainForm');	
<#if bo.formColumnListTab?exists && (bo.formColumnListTab?size>0)>	
param = param + "&"+ Form.serialize('${beanAttribute.boInstanceName}Form');;
</#if>	   
<#if subBoList?exists && (subBoList?size>0)>
	<#list subBoList as subBo>          <#-- 遍历业务对象下所有子对象 --> 
		   <#list bo.properties as property>
		        <#if property.subBoName==subBo.boName> 
		        	<#if property.subBoRelType=="2" || property.subBoRelType=="3">         <#-- 业务对象子对象关系为 1对多 -->
		        		param = param + ""+ get${subBo.boName}GridData();
		        	<#else> <#-- 业务对象子对象关系为 1对1 -->
		        		param = param +  "&"+ Form.serialize('${subBo.beanAttribute.boInstanceName}Form');		
		            </#if>
		        </#if>
		   </#list>
	</#list>
</#if>
    //alert(param);
	new AjaxEngine(contextPath + '/${beanAttribute.webPath}/${beanAttribute.boInstanceName}Controller.spr?action=_saveOrUpdate', 
		   {method:"post", parameters: param, onComplete: callBackHandle,callBack:customCallBackHandle});
}

/**
 * 操作成功后的回调动作
 */
function customCallBackHandle(transport)
{
	var responseUtil = new AjaxResponseUtils(transport.responseText);
	var id = responseUtil.getCustomField('coustom');
	document.getElementById("${beanAttribute.boName}.${bo.primaryKeyProperty.propertyName}").value = id;	
}
<#elseif formToolbar.method.methodName=="_create"> 

/**
 * 创建按钮调用方法 
 * 新增${beanAttribute.boDescription}
 */
function _create${beanAttribute.boName}()
{
	//增加页签
	top.maintabs.addPanel('${beanAttribute.boDescription}新增','','<%= request.getContextPath() %>/${beanAttribute.webPath}/${beanAttribute.boInstanceName}Controller.spr?action=_create');
}
<#elseif formToolbar.method.methodName=="_copyCreate"> 

function _copyCreate${beanAttribute.boName}()
{
	var ${bo.primaryKeyProperty.propertyName}= '${"$"}${"{"}${beanAttribute.boInstanceName}.${bo.primaryKeyProperty.propertyName}${"}"}';
	top.maintabs.addPanel('复制创建${beanAttribute.boDescription}','','<%= request.getContextPath() %>/${beanAttribute.webPath}/${beanAttribute.boInstanceName}Controller.spr?action=_copyCreate&${bo.primaryKeyProperty.propertyName}='+${bo.primaryKeyProperty.propertyName});
}
<#elseif formToolbar.method.methodName=="_cancel"> 

/**
 * 取消
 */
function _cancel${beanAttribute.boName}()
{
	top.maintabs.remove(top.maintabs.getActiveTab());
}
<#elseif formToolbar.method.methodName=="_delete"> 

/**
 * 删除${beanAttribute.boDescription}
 */
function _delete${beanAttribute.boName}()
{
	top.Ext.MessageBox.show({
		title:'提示',
		msg: '您选择了【${beanAttribute.boDescription}删除】操作,是否确定继续该操作?',
		buttons: {yes:'确定', no:'取消'},
		icon: Ext.MessageBox.QUESTION,
		fn:delete${beanAttribute.boName}
	});
	
	function delete${beanAttribute.boName}(result){
		if (result == 'yes'){
			var ${bo.primaryKeyProperty.propertyName} = '${"$"}${"{"}${beanAttribute.boInstanceName}.${bo.primaryKeyProperty.propertyName}${"}"}';	
			var param = '&${bo.primaryKeyProperty.propertyName}='+${bo.primaryKeyProperty.propertyName};
			new AjaxEngine(contextPath + '/${beanAttribute.webPath}/${beanAttribute.boInstanceName}Controller.spr?action=_delete', 
			{method:"post", parameters: param, onComplete: callBackHandle,callback:_deleteCallBackHandle});
		}
	}
}

/**
 * 删除成功后的回调动作
 */
function _deleteCallBackHandle()
{
	top.Ext.MessageBox.alert('提示', '操作成功！       ');
	top.maintabs.remove(top.maintabs.getActiveTab());
}

<#elseif formToolbar.method.methodName=="_create"> 

/**
 * 创建按钮调用方法 
 * 新增${beanAttribute.boDescription}
 */
function _create${beanAttribute.boName}()
{
	//增加页签
	top.maintabs.addPanel('${beanAttribute.boDescription}新增',${beanAttribute.boName}_grid,'<%= request.getContextPath() %>/${beanAttribute.webPath}/${beanAttribute.boInstanceName}Controller.spr?action=_create');
}
<#elseif formToolbar.method.methodName=="_copyCreate"> 
function _copyCreate${beanAttribute.boName}()
{
	var ${bo.primaryKeyProperty.propertyName}= records[0].json.${bo.primaryKeyProperty.propertyName};
	top.maintabs.addPanel('复制创建${beanAttribute.boDescription}',${beanAttribute.boName}_grid,'<%= request.getContextPath() %>/${beanAttribute.webPath}/${beanAttribute.boInstanceName}Controller.spr?action=_copyCreate&${bo.primaryKeyProperty.propertyName}='+${bo.primaryKeyProperty.propertyName});
}

<#elseif formToolbar.method.methodName=="_submitProcess"> 

/**
 * 提交
 */
function _submitProcess${beanAttribute.boName}(id)
{
	var param = Form.serialize('mainForm');	
<#if bo.formColumnListTab?exists && (bo.formColumnListTab?size>0)>	
	param = param + "&"+ Form.serialize('${beanAttribute.boInstanceName}Form');
</#if>	
<#if subBoList?exists && (subBoList?size>0)>
<#list subBoList as subBo>          <#-- 遍历业务对象下所有子对象 -->
	   <#list bo.properties as property>
	        <#if property.subBoName==subBo.boName> 
	        	<#if property.subBoRelType=="2" || property.subBoRelType=="3">         <#-- 业务对象子对象关系为 1对多 -->
	param = param + get${subBo.boName}GridData();
	        	<#else> <#-- 业务对象子对象关系为 1对1 -->
	param = param + "&" + Form.serialize('${subBo.beanAttribute.boInstanceName}Form');		
	            </#if>
	        </#if>
	   </#list>
</#list>
</#if>
	new AjaxEngine(contextPath +'/${beanAttribute.webPath}/${beanAttribute.boInstanceName}Controller.spr?action=_submitProcess', 
		   {method:"post", parameters: param, onComplete: callBackHandle,callback:_submitCallBackHandle});
}

/**
 * 提交后的回调动作
 */
function _submitCallBackHandle()
{
	top.Ext.MessageBox.alert('提示', '提交成功！');
	top.maintabs.remove(top.maintabs.getActiveTab());
}
</#if>
</#list>
</#if>

/**
 * EXT 布局
 */
//Ext.onReady(function(){
	var viewport = new Ext.Viewport({
		layout:"border",
		items:[{
					region:'center',
					layout:'border',
					items:[{
							region:'north',
							layout:'fit',
							height:29,
							contentEl:'div_toolbar'
						},{
							region:'center',
							layout:'anchor',
				            height:600,
				            autoScroll:true,
				            items:[{
				            	id:'currentWorkflowTask',
					            title: '流程审批信息',
					            layout:'fit',
					            anchor: '-20',
					            contentEl:'div_top_north'
					          },
				              {
				            		title:'${beanAttribute.boDescription}信息',
				            		layout:'fit',
				            		height:${formHieght},
				            		anchor: '-20',
				            		contentEl:'div_center'
						}
				<#if subBoList?exists && (subBoList?size>0)>
						,{
									xtype:'tabpanel',
					            	height:310,
					            	anchor:'-20',
					            	autoScroll: true,
									activeTab:0,
						           items:[
				<#if bo.formColumnListTab?exists && (bo.formColumnListTab?size>0)>
									    {
							            		title:'${beanAttribute.boDescription}',
							            		layout:'fit',
							            		contentEl:'div_${beanAttribute.boInstanceName}'
							             },
				</#if>
				<#list subBoList as subBo>          <#-- 遍历业务对象下所有子对象 -->
					<#if subBo.boName!="Attachement">   
						                {
						            		title:'${subBo.beanAttribute.boDescription}',
						            		layout:'fit',
						            		contentEl:'div_${subBo.beanAttribute.boInstanceName}'
						            	}<#if subBo_has_next>,</#if>
					</#if>
				</#list>
				<#list subBoList as subBo>          <#-- 此处可以不用-----遍历业务对象下所有子对象 -->
					<#if subBo.boName=="Attachement___">   
							      		{
						            		title:'附件',
						            		layout:'fit',
						            		contentEl:'div_attachement'
						            	}
					</#if>
				</#list>
						    ]}
						   ]}
						,{
							id:'historyWorkflowTask',
							region:'south',
							title:'流程跟踪信息',
		            		layout:'anchor',
		            		anchor: '-20',
			            	collapsible: true,
			            	collapsed:true,
			            	autoScroll: true,
							height:200,
							contentEl:'div_top_south'
						}]
			<#else>
				<#if bo.formColumnListTab?exists  && (bo.formColumnListTab?size>0)>
							,{
									xtype:'tabpanel',
					            	height:310,
					            	anchor:'-20',
					            	autoScroll: true,
									activeTab:0,
						            items:[
									     {
							            		title: '${beanAttribute.boDescription}',
							            		layout:'fit',
							            		contentEl:'div_${beanAttribute.boInstanceName}'
							             }]
							    }
				</#if>
								,{
								id:'historyWorkflowTask',
								region:'south',
								title:'流程跟踪信息',
			            		layout:'anchor',
			            		anchor: '-20',
				            	collapsible: true,
				            	collapsed:true,
				            	autoScroll: true,
								height:200,
								contentEl:'div_top_south'
							   }]
				   }]
			</#if>
				},{
					region:'east',
					width:200,
					contentEl:'div_east',
					collapsible: true,
					autoScroll: true,
					title:'相关操作'
				}]
	});

	var toolbars = new Ext.Toolbar({
			items:[
					'-',
					<#compress>
					<#if formToolbar.method?exists && (formToolbar?size>0)>
					<#list bo.formToolbars?if_exists?sort_by("orderNo") as formToolbar>          <#-- 遍历业务对象下所有方法 -->
					<#if formToolbar.method.methodName=="_create">
					{id:'${formToolbar.method.methodName}',text:'${formToolbar.method.methodDesc}',handler:${formToolbar.method.methodName}${beanAttribute.boName},iconCls:'${formToolbar.method.icon}'},'-',
					<#elseif formToolbar.method.methodName=="_copyCreate">
					{id:'${formToolbar.method.methodName}',text:'${formToolbar.method.methodDesc}',handler:${formToolbar.method.methodName}${beanAttribute.boName},iconCls:'${formToolbar.method.icon}'},'-',
					<#elseif formToolbar.method.methodName=="_delete">
					{id:'${formToolbar.method.methodName}',text:'${formToolbar.method.methodDesc}',handler:${formToolbar.method.methodName}${beanAttribute.boName},iconCls:'${formToolbar.method.icon}'},'-',					
					</#if>
					</#list>
					</#if>
					'->','-',
					<#if formToolbar.method?exists && (formToolbar?size>0)>
					<#list bo.formToolbars?if_exists?sort_by("orderNo") as formToolbar>          <#-- 遍历业务对象下所有方法 -->
					<#if formToolbar.method.methodName=="_saveOrUpdate">
					{id:'${formToolbar.method.methodName}',text:'${formToolbar.method.methodDesc}',handler:${formToolbar.method.methodName}${beanAttribute.boName},iconCls:'${formToolbar.method.icon}'},'-',
					<#elseif formToolbar.method.methodName=="_cancel">
					{id:'${formToolbar.method.methodName}',text:'${formToolbar.method.methodDesc}',handler:${formToolbar.method.methodName}${beanAttribute.boName},iconCls:'${formToolbar.method.icon}'},'-',
					<#elseif formToolbar.method.methodName=="_submit">
					{id:'${formToolbar.method.methodName}',text:'${formToolbar.method.methodDesc}',handler:${formToolbar.method.methodName}${beanAttribute.boName},iconCls:'${formToolbar.method.icon}'},'-',					
					</#if>
					</#list>
					</#if>
					<#if formToolbar.method?exists && (formToolbar?size>0)>
					<#list bo.formToolbars?if_exists?sort_by("orderNo") as formToolbar>          <#-- formToolbar.method.isDefault!="X" && 遍历业务对象下所有方法 -->
					<#if formToolbar.method.methodName!="_create" && formToolbar.method.methodName!="_copyCreate" && formToolbar.method.methodName!="_delete" && formToolbar.method.methodName!="_saveOrUpdate" && formToolbar.method.methodName!="_cancel" && formToolbar.method.methodName!="_submit">
					{id:'${formToolbar.method.methodName}',text:'${formToolbar.method.methodDesc}',handler:${formToolbar.method.methodName}${beanAttribute.boName},iconCls:'${formToolbar.method.icon}'},'-',
					</#if>
					</#list>
					</#if>
					'-',{text:' '}
					],</#compress>
			renderTo:'div_toolbar'
	});

	var isTask = '${"$"}${"{"}workflowTaskId${"}"}';
	if(!isTask||isTask==''){
		Ext.getCmp('currentWorkflowTask').hide();
		viewport.doLayout();
	}else{
<#compress>
<#if formToolbar.method?exists && (formToolbar?size>0)>
<#list bo.formToolbars?if_exists as formToolbar>          <#-- 遍历业务对象下所有方法 -->
<#if formToolbar.method.methodName=="_create"> 	
		Ext.getCmp('_create').disable();
<#elseif formToolbar.method.methodName=="_copyCreae"> 
		Ext.getCmp('_copyCreate').disable();
<#elseif formToolbar.method.methodName=="_deletes"> 
		Ext.getCmp('_deletes').disable();
<#elseif formToolbar.method.methodName=="_saveOrUpdate"> 	
		Ext.getCmp('_saveOrUpdate').disable();
<#elseif formToolbar.method.methodName=="_submitProcess"> 
		Ext.getCmp('_submitProcess').disable();
<#elseif formToolbar.method.methodName=="_cancel"> 
</#if>
</#list>
</#if>
</#compress>
	}
	
//});

</script>
<#-- 开始生成Tag-->
<#if subBoList?exists && (subBoList?size>0)>
	<#list subBoList as subBo>          <#-- 遍历业务对象下所有子对象 -->
		<#if subBo.boName!="Attachement">   
		   <#list bo.properties as property>
		        <#if property.subBoName==subBo.boName> 
		        	<#if property.subBoRelType=="2">         <#-- 业务对象子对象关系为 1对多 -->
<fisc:grid divId="div_${subBo.beanAttribute.boInstanceName}" boName="${subBo.beanAttribute.boName}" needCheckBox="true" editable="true" defaultCondition=" ${bo.primaryKeyProperty.propertyName}='${"$"}${"{"}${beanAttribute.boInstanceName}.${bo.primaryKeyProperty.propertyName}${"}"}'" needAutoLoad="true" height="285" nameSapceSupport="true"></fisc:grid>      
		            <#elseif  property.subBoRelType=="3">
<fisc:grid divId="div_${subBo.beanAttribute.boInstanceName}" boName="${subBo.beanAttribute.boName}" needCheckBox="true" editable="false" defaultCondition=" ${bo.primaryKeyProperty.propertyName}='${"$"}${"{"}${beanAttribute.boInstanceName}.${bo.primaryKeyProperty.propertyName}${"}"}'" needAutoLoad="true" height="285" nameSapceSupport="true"></fisc:grid>      
		            </#if>
		        </#if>
		   </#list>
		<#else>
<fisc:attachement businessId="${"$"}${"{"}${beanAttribute.boInstanceName}.${bo.primaryKeyProperty.propertyName}${"}"}" allowDelete="true" divId="div_attachement" boName="${beanAttribute.boName}" gridPageSize="10" gridHeight="285"></fisc:attachement>
		</#if>
	</#list>
<#else>
</#if>
<fisc:relationship divId="div_east" boName="${beanAttribute.boName}"></fisc:relationship>
<fisc:workflow-taskHistory divId="div_top_south" width="" businessRecordId="${"$"}${"{"}${beanAttribute.boInstanceName}.${bo.primaryKeyProperty.propertyName}${"}"}"></fisc:workflow-taskHistory>
<#-- 结束生成Tag-->
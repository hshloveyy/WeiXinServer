<?xml version="1.0" encoding="UTF-8"?>

<process-definition  xmlns=""  name="contract_sales_v1">


	<start-state name="合同申请">
		<transition to="部门经理确认" name="提交部门经理"></transition>
	</start-state>


	<task-node name="部门经理确认">
		<task name="部门经理确认"></task>
		<transition to="关联交易判断" name="确认提交"></transition>
		<transition to="更新订单状态为不通过" name="作废"></transition>
		<transition to="贸易类型判断" name="写入SAP订单 "></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
	</task-node>

	<task-node name="贸管经理审核">
		<task name="贸管经理审核"></task>
		<transition to="股份副总兼外贸公司总经理审批" name="提交股份公司副总审批"></transition>
		<transition to="合同信息修改" name="退回业务修改"></transition>
		<transition to="财务会计审核" name="退回财务"></transition>
		<transition to="贸管专员审核" name="退回贸管专员"></transition>
	</task-node>

	<task-node name="财务经理审核">
		<task name="财务经理审核"></task>
		<transition to="分管领导审核" name="同意"></transition>
		<transition to="合同信息修改" name="退回业务修改"></transition>
	</task-node>

	<task-node name="股份公司常务副总审批">
		<task name="股份公司常务副总审批"></task>
		<transition to="股份公司总经理审批" name="同意"></transition>
		<transition to="更新订单状态为不通过" name="不批准"></transition>
		<transition to="贸管经理审核" name="退回贸管经理审核"></transition>
	</task-node>

	<task-node name="股份副总兼外贸公司总经理审批">
		<task name="股份副总兼外贸公司总经理审批"></task>
		<transition to="金额判断2" name="通过"></transition>
		<transition to="贸管经理审核" name="退回贸管审核"></transition>
		<transition to="更新订单状态为不通过" name="不批准"></transition>
	</task-node>

	<task-node name="股份公司总经理审批">
		<task name="股份公司总经理审批"></task>
		<transition to="金额判断3" name="通过"></transition>
		<transition to="贸管经理审核" name="退回贸管审核"></transition>
		<transition to="更新订单状态为不通过" name="不批准"></transition>
	</task-node>

	<task-node name="股份公司董事长审批">
		<task name="股份公司董事长审批"></task>
		<transition to="写入SAP订单1" name="通过"></transition>
		<transition to="贸管经理审核" name="退回贸管审核"></transition>
		<transition to="更新订单状态为不通过" name="不批准"></transition>
	</task-node>

	<task-node name="合同信息修改">
		<task name="合同信息修改"></task>
		<transition to="部门经理确认" name="提交部门经理"></transition>
	</task-node>

	<task-node name="信息中心处理写入错误 ">
		<task name="信息中心处理写入错误"></task>
		<transition to="更新订单状态为（未经领导审批）" name="错误解决，SAP订单已生成成功"></transition>
	</task-node>

	<task-node name="信息中心处理错误">
		<task name="信息中心处理错误"></task>
		<transition to="更新订单状态" name="错误解决，SAP订单已生成成功"></transition>
	</task-node>

	<node name="更新订单状态">
		<action class="com.infolion.sapss.workflow.sales.ProcessSucessfulActionHandler"></action>
		<transition to="合同申请通过"></transition>
	</node>

	<node name="写入SAP订单1">
		<action class="com.infolion.sapss.workflow.sales.WriteSapOrderActionHandler"></action>
		<transition to="判断是否产生写入错误"></transition>
	</node>

	<node name="更新订单状态为不通过">
		<action class="com.infolion.sapss.workflow.sales.ProcessFaileActionHandler"></action>
		<transition to="合同申请不通过"></transition>
	</node>

	<node name="写入SAP订单2">
		<action class="com.infolion.sapss.workflow.sales.WriteSapOrderActionHandler"></action>
		<transition to="判断是否写入错误 "></transition>
	</node>

	<decision name="判断是否写入错误 ">
		<handler config-type="bean" class="com.infolion.sapss.workflow.decision.WriteSapResultDecisionHandler"></handler>
		<transition to="信息中心处理写入错误 " name="产生错误">
		</transition>
		<transition to="更新订单状态为（未经领导审批）" name="生成SAP订单成功">
		</transition>
	</decision>


	<node name="更新订单状态为（未经领导审批）">
		<action class="com.infolion.sapss.workflow.sales.ProcessNoExamineActionHandler"></action>
		<transition to="合同申请通过（未经领导审批）"></transition>
	</node>

	
	<decision name="金额判断2">
		<handler config-type="bean" class="com.infolion.sapss.workflow.decision.Price2JudgeDecisionHandler"></handler>
		<transition to="写入SAP订单1" name="金额小于100万美金或700万人民币">
		</transition>
		<transition to="股份公司常务副总审批" name="金额大于100万美金或700万人民币"></transition>
	</decision>

	<decision name="金额判断3">
		<handler config-type="bean" class="com.infolion.sapss.workflow.decision.Price3JudgeDecisionHandler"></handler>
		<transition to="股份公司董事长审批" name="金额大于200万美金或1400万人民币">
		</transition>
		<transition to="写入SAP订单1" name="金额小于200万美金或1400万人民币">
		</transition>
	</decision>

	<decision name="判断是否产生写入错误">
		<handler config-type="bean" class="com.infolion.sapss.workflow.decision.WriteSapResultDecisionHandler"></handler>
		<transition to="信息中心处理错误" name="产生错误">
		</transition>
		<transition to="更新订单状态" name="生成SAP订单成功">
		</transition>
	</decision>
	<decision name="关联交易判断">
        <handler config-type="bean" class="com.infolion.sapss.workflow.payment.IsRelationDecisionHandler"></handler>
		<transition to="证券事业部审核" name="关联交易"></transition>
		<transition to="财务会计审核" name="非关联交易"></transition>
	</decision>

	<task-node name="证券事业部审核">
	    <task name="证券事业部审核"></task>
		<transition to="财务会计审核" name="确认"></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
	</task-node>

	<task-node name="分管领导审核">
	    <task name="分管领导审核"></task>
		<transition to="资金部经理审核" name="同意"></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
	</task-node>

	<task-node name="资金部经理审核">
	    <task name="资金部经理审核"></task>
		<transition to="贸管专员审核" name="同意"></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
	</task-node>

	<task-node name="贸管部报备">
	    <task name="贸管部报备"></task>
		<transition to="写入SAP订单2" name="确认"></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
	</task-node>

	<decision name="贸易类型判断">
	    <handler config-type="bean" class="com.infolion.sapss.workflow.decision.SaleBusinessTypeDecisionHandler"></handler>
		<transition to="贸管部报备" name="出口"></transition>
		<transition to="写入SAP订单2" name="非出口"></transition>
	</decision>

	<decision name="系统判断1">
	    <handler config-type="bean" class="com.infolion.sapss.workflow.decision.BusTypePriceDecisionHandler"></handler>
		<transition to="财务经理审核" name="非出口或出口金额大于100万CNY"></transition>
		<transition to="财务经理审核*" name="出口且金额小于100万CNY"></transition>
	</decision>

	<task-node name="财务经理审核*">
	    <task name="财务经理审核*"></task>
		<transition to="分管领导审核" name="同意"></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
	</task-node>

	<task-node name="财务会计审核">
	    <task name="财务会计审核"></task>
		<transition to="系统判断1" name="同意"></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
	</task-node>

	<task-node name="贸管专员审核">
	    <task name="贸管专员审核"></task>
		<transition to="股份副总兼外贸公司总经理审批" name="确认提交"></transition>
		<transition to="贸管经理审核" name="提交贸管经理审核"></transition>
		<transition to="合同信息修改" name="退回修改"></transition>
		<transition to="财务会计审核" name="退回财务"></transition>
	</task-node>


	<end-state name="合同申请通过"></end-state>

	<end-state name="合同申请不通过"></end-state>

	<end-state name="合同申请通过（未经领导审批）"></end-state>


</process-definition>